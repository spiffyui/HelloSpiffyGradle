defaultTasks "clean", "htmlProps", "build", "serverInstructions", "jettyRunWar"

buildscript {

    /*
     * Change this location to point to your GWT plugin build libs directory
     */
    repositories { flatDir(dirs: "../../../tmp/gwt-gradle-plugin/build/libs/") }
    dependencies { classpath 'com.markuskobler.gradle:gwt-gradle-plugin:0.1-SNAPSHOT' }
}

buildscript {
    /*
     * This pulls in the Spiffy UI build tasks which are used only for compilation
     */
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath group: 'org.spiffyui', name: 'spiffyuitasks', version: '0.7.6'
    }
}

apply plugin: 'war'
apply plugin: 'jetty'
apply plugin: com.markuskobler.gradle.plugin.gwt.Gwt2Plugin

group = 'HelloSpiffyGradle'
version = '0.1-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
//    groovy group: 'org.codehaus.groovy', name: 'groovy', version: '1.7.9'
    //groovy group: 'org.apache.ivy', name:'ivy', version:'2.2.0'
    providedCompile 'javax.servlet:servlet-api:2.5'
    compile 'org.spiffyui:spiffyui:0.7.6'
    compile group: 'javax.validation', name: 'validation-api', version: '1.0.0.GA'
    compile group: 'javax.validation', name: 'validation-api', version: '1.0.0.GA', classifier: 'sources'
    compile files('build/gen');
}

gwtVersion = '2.3.0'
gwtModule = 'org.spiffyui.hellospiffygradle.index'
gwtStartupUrl = 'index.html'

jettyRunWar.contextPath = '/'

task htmlProps << {
    
    FileTree tree = fileTree(dir: 'src/main/html')
    tree.include '**/*.html'
    
    List<File> files = new ArrayList<File>();
    tree.each {File file ->
        files.add(file)
    }   
    
    File gen = new File('build/gen/org/spiffyui/hellospiffygradle/client')
    gen.mkdirs();
    
    String pkg = 'org.spiffyui.hellospiffygradle.client'
    
    org.spiffyui.build.HTMLPropertiesUtil.generatePropertiesFiles(files, new File(gen, 'SpiffyUiHtml.properties'), pkg);
}

task serverInstructions << {
    println '========================================================================'
    println '    Running the Spiffy UI application with an embedded'
    println '    Jetty server. Press Ctrl+C to stop the server. '
    println ''
    println '    Access Hello Spiffy Gradle at: http://localhost:8080'
    println '========================================================================'
        
}
